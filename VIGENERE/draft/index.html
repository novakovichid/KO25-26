<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ctext y=%22.9em%22 font-size=%2290%22%3E%F0%9F%A7%91%E2%80%8D%F0%9F%94%AC%3C/text%3E%3C/svg%3E">
  <script src="../../section-auth.js"></script>
  <script>window.SectionAuth && window.SectionAuth.guardPage("VIGENERE");</script>
  <title>Черновик</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #draftEditor {
      caret-color: #111827;
    }
    #draftEditor:focus {
      outline: none;
    }
    #draftEditor::selection,
    #draftEditor *::selection {
      background: inherit;
      color: inherit;
    }
    .toolbar-btn[data-active="true"] {
      border-color: rgb(20 184 166);
      background: rgb(240 253 250);
      color: rgb(15 118 110);
    }
  </style>
</head>
<body class="min-h-screen bg-slate-100 text-slate-900">
  <main class="mx-auto flex min-h-screen w-full max-w-6xl items-center px-4 py-10 sm:px-6">
    <section class="w-full rounded-3xl border border-slate-200 bg-white p-8 shadow-xl">
      <h1 class="text-2xl font-black tracking-tight">Черновик</h1>
      <div class="mt-6 rounded-2xl border border-slate-200 bg-slate-50 p-4">
        <div class="flex flex-wrap items-center gap-2">
          <button type="button" class="toolbar-btn rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm font-semibold" data-cmd="bold" title="Жирный">Ж</button>
          <button type="button" class="toolbar-btn rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm italic" data-cmd="italic" title="Курсив">К</button>
          <button type="button" class="toolbar-btn rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm underline" data-cmd="underline" title="Подчеркивание">П</button>

          <label class="ml-1 flex items-center gap-2 rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm">
            <span class="text-slate-600">Шрифт</span>
            <select id="fontFamilySelect" class="rounded border border-slate-300 px-2 py-1 text-sm">
              <option value="Arial, sans-serif">Без засечек</option>
              <option value="'Times New Roman', serif">С засечками</option>
              <option value="'Roboto Mono', 'Courier New', monospace">Моноширинный</option>
              <option value="'Georgia', serif">Книжный</option>
            </select>
          </label>

          <label class="flex items-center gap-2 rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm">
            <span class="text-slate-600">Цвет текста</span>
            <input id="textColorInput" type="color" value="#ffffff" class="h-8 w-10 cursor-pointer rounded border border-slate-300 bg-white p-0.5">
          </label>

          <label class="flex items-center gap-2 rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm">
            <span class="text-slate-600">Фон текста</span>
            <input id="bgColorInput" type="color" value="#4a86e8" class="h-8 w-10 cursor-pointer rounded border border-slate-300 bg-white p-0.5">
          </label>
        </div>

        <div class="mt-4 rounded-2xl border border-slate-300 bg-white p-3">
          <div
            id="draftEditor"
            class="min-h-[560px] rounded-xl border border-slate-200 bg-white p-4 text-[16px] leading-6"
            contenteditable="true"
            spellcheck="false"
            aria-label="Черновик сценария"
          >
            <p style="margin: 0 0 12px; text-align: center; font-weight: 700; font-size: 22px;">Сценарий к видео</p>
            <p style="margin: 0 0 8px;">&nbsp;</p>
            <p style="margin: 0 0 4px;"><span class="secret-char" style="font-family: 'Roboto Mono', 'Courier New', monospace; color: #4a86e8; background-color: #4a86e8;">Д</span></p>
            <p style="margin: 0 0 4px;"><span style="font-family: 'Roboto Mono', 'Courier New', monospace; color: #ffffff; background-color: #4a86e8;">Всем привет!</span></p>
            <p style="margin: 0 0 4px;"><span class="secret-char" style="font-family: 'Roboto Mono', 'Courier New', monospace; color: #4a86e8; background-color: #4a86e8;">О</span></p>
            <p style="margin: 0 0 4px;"><span style="font-family: 'Roboto Mono', 'Courier New', monospace; color: #ffffff; background-color: #4a86e8;">В этом видео хочу рассказать, как я обычно подхожу к монтажу</span></p>
            <p style="margin: 0 0 4px;"><span style="font-family: 'Roboto Mono', 'Courier New', monospace; color: #ffffff; background-color: #4a86e8;">и подготовке контента. Многие думают, что всё делается за пару минут,но на самом деле за кадром остаётся много рутинной работы.</span></p>
            <p style="margin: 0 0 4px;"><span class="secret-char" style="font-family: 'Roboto Mono', 'Courier New', monospace; color: #4a86e8; background-color: #4a86e8;">С</span></p>
            <p style="margin: 0 0 4px;"><span style="font-family: 'Roboto Mono', 'Courier New', monospace; color: #ffffff; background-color: #4a86e8;">Обычно я заранее пишу план, проверяю звук и свет,</span></p>
            <p style="margin: 0 0 4px;"><span style="font-family: 'Roboto Mono', 'Courier New', monospace; color: #ffffff; background-color: #4a86e8;">делаю несколько пробных записей и только потом</span></p>
            <p style="margin: 0 0 4px;"><span style="font-family: 'Roboto Mono', 'Courier New', monospace; color: #ffffff; background-color: #4a86e8;">начинаю финальный монтаж.</span></p>
            <p style="margin: 0 0 4px;"><span class="secret-char" style="font-family: 'Roboto Mono', 'Courier New', monospace; color: #4a86e8; background-color: #4a86e8;">Т</span></p>
            <p style="margin: 0 0 4px;"><span style="font-family: 'Roboto Mono', 'Courier New', monospace; color: #ffffff; background-color: #4a86e8;">Кстати, меня часто спрашивают, где я храню исходники и черновики. На самом деле ничего необычного — главное, чтобы</span></p>
            <p style="margin: 0 0 4px;"><span style="font-family: 'Roboto Mono', 'Courier New', monospace; color: #ffffff; background-color: #4a86e8;">всегда был доступ к материалам и возможность восстановить их</span></p>
            <p style="margin: 0 0 4px;"><span style="font-family: 'Roboto Mono', 'Courier New', monospace; color: #ffffff; background-color: #4a86e8;">в случае ошибки.</span></p>
            <p style="margin: 0 0 4px;"><span style="font-family: 'Roboto Mono', 'Courier New', monospace; color: #4a86e8; background-color: #4a86e8;">У</span></p>
            <p style="margin: 0 0 4px;"><span style="font-family: 'Roboto Mono', 'Courier New', monospace; color: #ffffff; background-color: #4a86e8;">Спасибо за поддержку! Если видео понравится —</span></p>
            <p style="margin: 0 0 4px;"><span style="font-family: 'Roboto Mono', 'Courier New', monospace; color: #ffffff; background-color: #4a86e8;">не забудьте поставить лайк и написать комментарий.</span></p>
            <p style="margin: 0;"><span class="secret-char" style="font-family: 'Roboto Mono', 'Courier New', monospace; color: #4a86e8; background-color: #4a86e8;">П</span></p>
          </div>
        </div>
      </div>
      <a href="../index.html" class="mt-8 inline-flex items-center rounded-xl bg-slate-700 px-4 py-2 text-sm font-semibold text-white transition hover:bg-slate-800">Назад в меню Виженера</a>
    </section>
  </main>
  <script>
    (function () {
      const editor = document.getElementById("draftEditor");
      const fontSelect = document.getElementById("fontFamilySelect");
      const textColorInput = document.getElementById("textColorInput");
      const bgColorInput = document.getElementById("bgColorInput");
      const cmdButtons = Array.from(document.querySelectorAll(".toolbar-btn[data-cmd]"));
      if (!editor) return;

      let savedRange = null;

      function saveSelection() {
        const sel = window.getSelection();
        if (!sel || sel.rangeCount === 0) return;
        const range = sel.getRangeAt(0);
        if (!editor.contains(range.commonAncestorContainer)) return;
        savedRange = range.cloneRange();
      }

      function restoreSelection() {
        const sel = window.getSelection();
        if (!sel || !savedRange) return false;
        sel.removeAllRanges();
        sel.addRange(savedRange);
        return true;
      }

      function focusEditorAndRestore() {
        editor.focus();
        restoreSelection();
      }

      function exec(cmd, value) {
        focusEditorAndRestore();
        document.execCommand("styleWithCSS", false, true);
        document.execCommand(cmd, false, value);
        saveSelection();
        updateToolbarState();
      }

      function applyTextColor(color) {
        exec("foreColor", color);
      }

      function applyBgColor(color) {
        focusEditorAndRestore();
        document.execCommand("styleWithCSS", false, true);
        if (!document.execCommand("hiliteColor", false, color)) {
          document.execCommand("backColor", false, color);
        }
        saveSelection();
      }

      function applyFontFamily(fontFamily) {
        exec("fontName", fontFamily);
      }

      function updateToolbarState() {
        cmdButtons.forEach((btn) => {
          const cmd = btn.dataset.cmd;
          if (!cmd) return;
          let active = false;
          try { active = document.queryCommandState(cmd); } catch (_) {}
          btn.setAttribute("data-active", active ? "true" : "false");
        });
      }

      cmdButtons.forEach((btn) => {
        const cmd = btn.dataset.cmd;
        if (!cmd) return;
        btn.addEventListener("mousedown", (event) => event.preventDefault());
        btn.addEventListener("click", () => exec(cmd));
      });

      if (fontSelect) {
        fontSelect.addEventListener("mousedown", () => saveSelection());
        fontSelect.addEventListener("change", () => applyFontFamily(fontSelect.value));
      }
      if (textColorInput) {
        textColorInput.addEventListener("mousedown", () => saveSelection());
        textColorInput.addEventListener("change", () => applyTextColor(textColorInput.value));
      }
      if (bgColorInput) {
        bgColorInput.addEventListener("mousedown", () => saveSelection());
        bgColorInput.addEventListener("change", () => applyBgColor(bgColorInput.value));
      }

      editor.addEventListener("mouseup", saveSelection);
      editor.addEventListener("keyup", () => {
        saveSelection();
        updateToolbarState();
      });
      editor.addEventListener("focus", () => {
        saveSelection();
        updateToolbarState();
      });
      document.addEventListener("selectionchange", saveSelection);

      updateToolbarState();
    })();
  </script>
</body>
</html>
