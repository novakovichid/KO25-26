# Local Agent Rules

- После каждой правки сразу делать коммит.
- При каждом коммите обновлять память в этом же файле (`AGENTS.md`).

## Memory

- 2026-02-19: В `LOVELACE/editor.html` текст подзадач 2.1/2.2 переведен на три строки формата «Для значения X нужно получить значение Y.» и отображается через `<p>`.
- 2026-02-19: В `LOVELACE/editor.html` для подзадач с эталоном (`2.1/2.2`) статус «выполнены успешно» показывается только при точном совпадении эталонных тестов и выходов.
- 2026-02-19: Для `Задание 4 / Подзадача 4.1` в `LOVELACE/editor.html` добавлен текст-напоминание про задачу «второй максимум», а код по умолчанию очищен.
- 2026-02-19: Для `Подзадач 1.1–1.4` в `LOVELACE/editor.html` добавлены тексты «Проверить выходные данные для значения X.» (11, 25, 6, 14).
- 2026-02-19: Добавлен локальный файл `LOVELACE/etalon-solutions.local.txt` с эталонами и кодовыми фразами для `2.1/2.2`; путь внесен в `.gitignore`.
- 2026-02-19: В `LOVELACE/etalon-solutions.local.txt` для `2.1/2.2` добавлены эмодзи-программы решений (`x+4` и `x/2`).
- 2026-02-20: `section-auth.js` расширен профилями `LOVELACE` (`CLASSIC`/`ROBOT`) и профильной проверкой в `guardPage`; маршрутизация Lovelace переведена через `LOVELACE/index.html`, а `LOVELACE/editor.html` закрыт профилем `CLASSIC`.
- 2026-02-20: Добавлены `LOVELACE/editor-robot.html`, `LOVELACE/js/lab-shell.js`, `LOVELACE/js/domain-robot.js` и `LOVELACE/js/domain-classic.js`; robot-ветка работает без переменных, с keycap-цифрами, растительными цветами и отдельным DSL команд/предикатов.
- 2026-02-20: `LOVELACE/js/domain-classic.js` обновлен со stub до полноценного classic-движка (парсер и исполнение команд текущего формата).
- 2026-02-20: Добавлена локальная robot-справка `dev/lovelace/emoji-robot-reference.local.html`, путь внесен в `.gitignore`; на клиентской robot-странице подтверждено 5 примеров.
- 2026-02-20: В `LOVELACE/editor-robot.html` убрана панель ручных тестов, добавлена визуализация поля сценария; сценарии переведены в скрытые закодированные blobs, а проверка успеха идет только при запуске через `fixedTestsByScenario` и снимки состояния (`snapshot`) из `LOVELACE/js/domain-robot.js`.
- 2026-02-20: В robot-ветке (`LOVELACE/editor-robot.html`) добавлен toggle микроанимации движения робота, цветовые подсказки из легенды поля убраны, а примеры усложнены; `LOVELACE/js/domain-robot.js` теперь возвращает трассу шагов (`trace`), и `LOVELACE/js/lab-shell.js` передает лимит `maxTracePoints` в runtime.
- 2026-02-20: В `LOVELACE/editor-robot.html` скрыт блок `Выходные данные` (панель 5) для robot-ветки; технический контейнер `#testOutputs` сохранен в DOM, чтобы не ломать общий shell.
- 2026-02-20: В `LOVELACE/editor.html` добавлено `Задание 3` с двумя подзадачами (`3.1`, `3.2`) по аналогии с `2.*`: стартовые программы с циклами, по 3 теста и эталонная проверка через `CODE_PHRASE_UNLOCK_RULES` (без вывода кодовой фразы, `blob` пустой), чтобы проверялись именно целевые выходы.
- 2026-02-20: В `LOVELACE/editor.html` убраны подсказки про изменение конкретной строки цикла для `3.1/3.2`; в `LOVELACE/etalon-solutions.local.txt` добавлены эталонные эмодзи-решения для `3.*`.
- 2026-02-20: Полностью ротированы пароли разделов (включая профили `LOVELACE` и `VIGENERE`) под формат сложной устной передачи; в `section-auth.js` обновлены все хэши и профильные соответствия, а `passwords.local.txt` синхронизирован и дополнен (`LOVELACE_CLASSIC`/`LOVELACE_ROBOT`).
- 2026-02-20: В `dev/lovelace/emoji-gramming-reference.local.html` слиты classic+robot справки в один локальный документ; `dev/lovelace/emoji-robot-reference.local.html` удален локально. В репозитории вся папка `dev` переведена под игнор (`.gitignore: dev/`) и снята с трекинга (`git rm --cached -r dev`).
- 2026-02-20: Для правила «в гите только клиентское» в `.gitignore` добавлены не-клиентские пути (`.githooks/`, `scripts/`, `**/md-todo.md`, `VIGENERE/draft/`); соответствующие файлы сняты с трекинга через `git rm --cached`.
- 2026-02-20: По уточнению, `VIGENERE/draft` относится к клиентской легенде: исключение `VIGENERE/draft/` убрано из `.gitignore`, папка возвращена в трекинг. Пароли разделов упрощены до букво-цифрового формата для 5-6 классов и синхронизированы с `section-auth.js`/`passwords.local.txt`.
- 2026-02-20: В локальном `LOVELACE/etalon-solutions.local.txt` формат для `2.*` и `3.*` изменен: первично указываются «Ответы (выходы)», пары «вход -> ответ» оставлены дополнительным блоком.
- 2026-02-20: В `LOVELACE/etalon-solutions.local.txt` коды для `2.*` и `3.*` явно помечены как «Эмодзи-программа (решение)»; добавлено уточнение, что начальный код в этом файле не хранится.
- 2026-02-20: В локальной `dev/lovelace/emoji-gramming-reference.local.html` robot-раздел справки приведен к формату консольной части: детализированы команды/предикаты, добавлены правила синтаксиса, модель выполнения и 5 мини-примеров.
- 2026-02-20: В `LOVELACE/editor.html` для подзадач `3.1/3.2` включено открытие блока 6 по точному совпадению эталонов (как в `2.*`): добавлены обфусцированные code-phrases через `seed/blob` (`3.1: ЦикЛ#R-пет7Ля`, `3.2: RoBot&Вит0к9`).
- 2026-02-20: В локальном `LOVELACE/etalon-solutions.local.txt` добавлены кодовые фразы для `3.1/3.2`, чтобы в эталонках были все коды, выдаваемые при решении задач с unlock-логикой (`2.*` и `3.*`).
- 2026-02-20: В `LOVELACE/editor.html` и `LOVELACE/js/lab-shell.js` для UX синхронизировано общее правило: если у задания одна подзадача (`count === 1`), блок переключателя подзадач скрывается, при этом остается автовыбор `taskKey + ".1"`.
- 2026-02-20: В `LOVELACE/editor.html` добавлен режим `4.1` с фиксированными тестами из обфусцированного blob: запуск считается по 10 кейсам в памяти, в UI показываются только 3 открытых read-only теста, а для `4.1` скрыты/заблокированы кнопки изменения списка тестов.
- 2026-02-20: В `LOVELACE/editor.html` для `4.1` добавлено открытие блока 6 только при полном совпадении 10/10 по эталонам из blob; фраза читается из того же обфусцированного контейнера данных.
- 2026-02-20: В локальном `LOVELACE/etalon-solutions.local.txt` добавлен раздел `4.1`: формальное правило, 10 пар вход->ответ, кодовая фраза и рабочая эмодзи-программа решения (файл в ignore).
- 2026-02-20: В `LOVELACE/editor-robot.html` собран аналогичный набор из 4 заданий под Robot DSL: `1.*` (4 базовые подзадачи с готовым стартовым кодом), `2.*` (2 подзадачи без стартового кода, по 3 сценария), `3.*` (2 подзадачи с циклами и стартовым кодом), `4.1` (1 подзадача, 10 сценариев). Обновлены `ROBOT_SUBTASK_PRESETS`, `ROBOT_SUBTASK_TEXTS`, `taskSubtaskCounts` и obfuscated `ROBOT_SCENARIO_BLOBS` для `task:*`.
- 2026-02-20: В `LOVELACE/editor.html` уточнен текст `4.1` в блоке задания: формулировка про сумму N чисел и сравнение с эталоном E приведена в точном пользовательском варианте.
- 2026-02-20: В `LOVELACE/editor-robot.html` на визуальном поле добавлены координаты от левого верхнего угла в keycap-emoji-цифрах; также для robot-примеров (`example:1..5`) и подзадачи `task:1.3` расширены фиксированные сценарии до нескольких полей (obfuscated blobs), чтобы коды с проверками валидировались на разных конфигурациях.
- 2026-02-20: В `LOVELACE/editor-robot.html` переформулированы тексты `ROBOT_SUBTASK_TEXTS` в задачном стиле («Дойдите до финиша…», «закрасьте клетки…») с конкретными требованиями, синхронизированными с фактическими проверками сценариев.
- 2026-02-20: В `LOVELACE/editor-robot.html` восстановлен многопольный показ сценариев: теперь рендерятся все видимые эталонные поля (для `4.1` остаются открыты только 3), анимация/переключатель работают по каждому полю отдельно; также обновлены 5 примеров до нарастающей сложности с покрытием движения, покраски, условий, цикла по счетчику, цикла по условию и температурных проверок.
- 2026-02-20: В `LOVELACE/editor.html` обновлена подзадача `4.1` под новый формат ввода «эталон E, затем числа до нуля»: заменен текст условия, пересобран obfuscated `TASK4_DATA_BLOB` с 10 тестами (3 открытых + 7 скрытых) и новыми эталонами по этой логике; локальный `LOVELACE/etalon-solutions.local.txt` синхронизирован (новые пары вход->ответ и программа-решение).
- 2026-02-20: Для `4.1` в `LOVELACE/editor.html` усложнена и существенно удлинена кодовая фраза (через пересборку obfuscated `TASK4_DATA_BLOB` без раскрытия в исходнике); локальная эталонка обновлена тем же значением.
- 2026-02-20: В `LOVELACE/editor-robot.html` подписи координатных осей на поле сделаны явными: угловая ячейка сетки теперь показывает `x/y`, чтобы оси `x` и `y` читались однозначно.
- 2026-02-20: В `LOVELACE/editor-robot.html` тексты robot-задач очищены от намеков на метод решения: убраны формулировки «используя цикл/измените программу/проверка по полям», оставлены только целевые состояния и конечные цели.
- 2026-02-20: В `LOVELACE/editor-robot.html` подпись осей усилена до явного формата с направлением: в угловой ячейке отображается `x→` и `y↓` (с tooltip), чтобы не было неоднозначности, где какая ось.
